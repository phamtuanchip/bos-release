webpackJsonp([16],{1217:function(e,t,a){var i=a(1218);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a(932)("963e3e64",i,!0)},1218:function(e,t,a){t=e.exports=a(931)(!0),t.push([e.i,".el-progress .el-progress__text{font-size:12.4px!important}.el-progress.full .el-progress-bar__inner{background:#67c23a}.el-progress.medium .el-progress-bar__inner{background:#409eff}.el-progress.little .el-progress-bar__inner{background:#ffc441}.el-progress.empty .el-progress-bar__inner{background:#f56c6c}","",{version:3,sources:["/Users/yuukininomae/Sites/vue-crm2/src/components/static/Kpis/Kpis.vue"],names:[],mappings:"AACA,gCACE,0BAA6B,CAC9B,AACD,0CACE,kBAAoB,CACrB,AACD,4CACE,kBAAoB,CACrB,AACD,4CACE,kBAAoB,CACrB,AACD,2CACE,kBAAoB,CACrB",file:"Kpis.vue",sourcesContent:["\n.el-progress .el-progress__text {\n  font-size: 12.4px !important;\n}\n.el-progress.full .el-progress-bar__inner {\n  background: #67c23a;\n}\n.el-progress.medium .el-progress-bar__inner {\n  background: #409eff;\n}\n.el-progress.little .el-progress-bar__inner {\n  background: #ffc441;\n}\n.el-progress.empty .el-progress-bar__inner {\n  background: #f56c6c;\n}\n"],sourceRoot:""}])},1219:function(e,t,a){"use strict";var i=a(104),r=a.n(i),l=a(1220),s=a(30),n=a.n(s);t.a={name:"Kpis",components:{CreateEditKpiDialog:l.a,ElTreeGrid:n.a,ElTableTreeColumn:n.a},props:{},data:function(){return{kpis:[],showKpiDialog:!1,kpiDialogType:null,kpiEditing:{Type:"",Status:"",Feature:"",Manager:"",Category:"",Categories:"",Planned:0,State:0,Priority:0,PlanStartDate:"",PlanFinishDate:"",Milestone:""},keywordSearchKpi:null,isSearch:!1,searchResult:[]}},methods:{requestGetKpis:function(){var e=this,t=[],a=this.$Lodash.cloneDeep(this.$singleRequest);return a.R1_RequestTemplate="AG_Task_Task.Search",a.R1_RequestDataGroup="DataGroup.kpi.03adg",a.R1_RequestFields="Type;TypeName;Status;StatusName;Category;CategoryName;Categories;CategoriesName;FeatureName;Manager;ManagerName;Planned;State;Priority;Milestone;MilestoneName;PlanStartDate;PlanFinishDate;Id;Code;Created;CreatedBy;;CreatedByName;Modified;ModifiedByName;",a.R1_Code="KPI",this.$Utils.post(a).then(function(t){e.kpis=e.$Utils.getDataWithRoot(t,"R1.Data.TasksDS.Task")}),t},handleCreateKpi:function(){this.kpiDialogType="create",this.showKpiDialog=!0},handleEditKpi:function(e){this.kpiEditing=this.kpis.filter(function(t){return t.id===e})[0],this.kpiEditing&&(this.kpiDialogType="edit",this.showKpiDialog=!0)},updateKpi:function(e){this.requestGetKpis(),this.showKpiDialog=!1,this.kpiEditing=null,this.$message({type:"success",message:"Đã cập nhật"})},createKpi:function(e){this.requestGetKpis(),this.showKpiDialog=!1,this.$message({type:"success",message:"Đã thêm"})},deleteKpi:function(e){var t=this;e&&this.$confirm("Xóa KPI này?",{confirmButtonText:"OK",cancelButtonText:"Hủy xóa",type:"warning"}).then(function(){t.kpis=t.kpis.filter(function(t){return t.id!==e}),t.$message({type:"success",message:"Đã xóa"})})},solveColorProgress:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e>90?"full":e>50?"medium":e>25?"little":"empty"}},created:function(){this.requestGetKpis()},watch:{keywordSearchKpi:function(e){var t=this;this.isSearch=e||e.trim(),e=this.$Utils.removeVNCharacters(e),this.isSearch?this.searchResult=this.kpis.filter(function(a){return t.$Utils.removeVNCharacters(r()(a).join("|")).indexOf(e)>-1}):this.searchResult=this.kpis},showKpiDialog:function(e){!1===e&&(this.kpiDialogType=null,this.kpiEditing=null)}}}},1220:function(e,t,a){"use strict";function i(e){a(1221)}var r=a(1223),l=a(1224),s=a(0),n=i,o=s(r.a,l.a,!1,n,"data-v-63c5824f",null);t.a=o.exports},1221:function(e,t,a){var i=a(1222);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a(932)("957e9180",i,!0)},1222:function(e,t,a){t=e.exports=a(931)(!0),t.push([e.i,"","",{version:3,sources:[],names:[],mappings:"",file:"CreateEditKpiDialog.vue",sourceRoot:""}])},1223:function(e,t,a){"use strict";(function(e){var i=a(4),r=a.n(i),l=a(105),s=a.n(l);t.a={name:"CreateEditKpiDialog",components:{},props:{onCreate:Function,onCancelCreate:Function,onEdit:Function,onCancelEdit:Function,type:{type:String,default:function(){return"create"},validator:function(e){return-1!==["edit","create"].indexOf(e)}},kpi:{type:Object}},data:function(){var e="edit"===this.type&&this.kpi?s()({},this.kpi):{};return{kpiForm:this.$Lodash.cloneDeep(e),kpiFormTemp:{},kpiCache:e,params:{targetObjs:[],levels:[],categories:[],indicators:[],units:[],cycle_times:[]},rules:{Type:[{required:!0,message:"Cấp độ bắt buộc có",trigger:"blur"}],Status:[{required:!0,message:"Đối tượng bắt buộc có",trigger:"blur"}]}}},methods:{validateTaskForm:function(e){this.$refs.kpiForm.validate(function(t){if(!t)return!1;e&&e()})},handleCreateTask:function(){var t=this;this.validateTaskForm(function(){t.kpiFormTemp=JSON.parse(r()(t.kpiForm));var a={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestTemplate:"AG_Task_Task.Insert",R1_RequestDataGroup:"DataGroup.kpi.03adg",R1_RequestFields:"Type;TypeName;Status;StatusName;Category;CategoryName;Categories;CategoriesName;FeatureName;Manager;ManagerName;Planned;State;Priority;Milestone;MilestoneName;PlanStartDate;PlanFinishDate;Id;Code;Created;CreatedBy;;CreatedByName;Modified;ModifiedByName;",R1_Code:"KPI",R1_CreatedByName:JSON.parse(localStorage.getItem("LoggedOnUser")).Username,R1_ModifiedByName:JSON.parse(localStorage.getItem("LoggedOnUser")).Username};e.each(t.kpiForm,function(i,r){if(t.$Utils.isEmpty(r)&&""!=r)if(r.constructor===Object)a["R1_"+i]=r.value,a["R1_"+i+"Name"]=r.label;else if(r.constructor===Array){var l="",s="";e.each(r,function(e,t){l+=t.value+";",s+=t.label+";"}),a["R1_"+i]=l,a["R1_"+i+"Name"]=s}else r.constructor===String&&(a["R1_"+i]=r)}),a.R1_PlanStartDate=t.$Utils.formatDateTime(a.R1_PlanStartDate),a.R1_PlanFinishDate=t.$Utils.formatDateTime(a.R1_PlanFinishDate),t.$Utils.post(a).then(function(e){}),t.kpiForm={},t.onCreate(t.kpiFormTemp)})},handleCancelCreate:function(){this.onCancelCreate()},handleEditTask:function(){var t=this;this.validateTaskForm(function(){t.kpiFormTemp=JSON.parse(r()(t.kpiForm));var a={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestTemplate:"AG_Task_Task.Update",R1_RequestDataGroup:"DataGroup.kpi.03adg",R1_RequestFields:"Type;TypeName;Status;StatusName;Category;CategoryName;Categories;CategoriesName;FeatureName;Manager;ManagerName;Planned;State;Priority;Milestone;MilestoneName;PlanStartDate;PlanFinishDate;Id;Code;Created;CreatedBy;;CreatedByName;Modified;ModifiedByName;",R1_Code:"KPI",R1_ModifiedByName:JSON.parse(localStorage.getItem("LoggedOnUser")).Username};e.each(t.kpiForm,function(i,r){if(t.$Utils.isEmpty(r)&&""!=r)if(r.constructor===Object)a["R1_"+i]=r.value,a["R1_"+i+"Name"]=r.label;else if(r.constructor===Array){var l="",s="";e.each(r,function(e,t){l+=t.value+";",s+=t.label+";"}),a["R1_"+i]=l,a["R1_"+i+"Name"]=s}else r.constructor===String&&(a["R1_"+i]=r)}),a.R1_PlanStartDate=t.$Utils.formatDateTime(a.R1_PlanStartDate),a.R1_PlanFinishDate=t.$Utils.formatDateTime(a.R1_PlanFinishDate),e.each(t.kpiCache,function(e,t){t==a["R1_"+e]&&delete a["R1_"+e]}),t.$Utils.post(a).then(function(e){}),t.kpiForm={},t.onCreate(t.kpiFormTemp)})},handleCancelEdit:function(){this.onCancelEdit()},getAllParameters:function(){var e=this,t=this.$Lodash.cloneDeep(this.$singleRequest);t.TotalRequests=4,t.R1_RequestTemplate="Setting.SearchBase",t.R1_ParentCode="xSetting.Project.Parameter.KPI.Level",t.R2_RequestTemplate="Setting.SearchBase",t.R2_ParentCode="xSetting.Project.Parameter.KPI.Category",t.R3_RequestTemplate="Setting.SearchBase",t.R3_ParentCode="xSetting.Project.Parameter.KPI.Unit",t.R4_RequestTemplate="Setting.SearchBase",t.R4_ParentCode="xSetting.Project.Parameter.KPI.TimeType";var a={RequestAction:"SearchGroup",RequestClass:"BPM",RequestDataType:"json",ConditionFields:"Status;GroupType",Status:"1",GroupType:1,StaticFields:"GroupId;GroupName;Description;GroupParent;GroupType;LeftIndex"},i={RequestClass:"BPM",RequestAction:"SearchUsers",TotalRequests:1,StaticFields:"UserId;Username;LoginName;Status",ConditionFields:"Status",Status:1};this.$Utils.post(t).then(function(t){e.params.levels=e.$Utils.getDataWithRoot(t.R1,"Data.DynamicDS.Setting").map(function(e){return s()({},e,{value:e.Code,label:e.Name})}),e.params.categories=e.$Utils.getDataWithRoot(t.R2,"Data.DynamicDS.Setting").map(function(e){return s()({},e,{value:e.Code,label:e.Name})}),e.params.units=e.$Utils.getDataWithRoot(t.R3,"Data.DynamicDS.Setting").map(function(e){return s()({},e,{value:e.Code,label:e.Name})}),e.params.cycle_times=e.$Utils.getDataWithRoot(t.R4,"Data.DynamicDS.Setting").map(function(e){return s()({},e,{value:e.Code,label:e.Name})})}),this.$Utils.post(a).then(function(t){e.params.groups=e.$Utils.getDataWithRoot(t,"UserDS.Group").map(function(e){return s()({},e,{value:e.GroupId,label:e.GroupName})}),e.params.targetObjs.push({label:"Đơn vị",value:"groups",options:e.params.groups})}),this.$Utils.post(i).then(function(t){e.params.users=t.Data.UserDS.User.map(function(e){return s()({},e,{value:e.UserId,label:e.Username})}),e.params.targetObjs.push({label:"Cá nhân",value:"users",options:e.params.users})})}},created:function(){this.getAllParameters()},computed:{},watch:{}}}).call(t,a(2))},1224:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"CreateEditKpiDialog__ROOT"},[a("el-form",{ref:"kpiForm",attrs:{model:e.kpiForm,"label-width":"120px",rules:e.rules,"label-position":e.$isMobileDevice?"top":"right"}},[a("el-form-item",{attrs:{label:"Cấp độ",prop:"Type","value-key":"value"}},[a("el-select",{attrs:{placeholder:"Cấp độ"},model:{value:e.kpiForm.Type,callback:function(t){e.$set(e.kpiForm,"Type",t)},expression:"kpiForm.Type"}},e._l(e.params.levels,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"Đối tượng",prop:"Status","value-key":"value"}},[a("el-select",{attrs:{placeholder:"Đối tượng"},model:{value:e.kpiForm.Status,callback:function(t){e.$set(e.kpiForm,"Status",t)},expression:"kpiForm.Status"}},e._l(e.params.targetObjs,function(t){return a("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e}})}))}))],1),e._v(" "),a("el-form-item",{attrs:{label:"Chịu trách nhiệm",prop:"Category","value-key":"value"}},[a("el-select",{attrs:{placeholder:"Chịu trách nhiệm",clearable:""},model:{value:e.kpiForm.Category,callback:function(t){e.$set(e.kpiForm,"Category",t)},expression:"kpiForm.Category"}},e._l(e.params.users,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"Chịu trách nhiệm",prop:"Categories","value-key":"value"}},[a("el-select",{attrs:{placeholder:"Chịu trách nhiệm",clearable:"",multiple:""},model:{value:e.kpiForm.Categories,callback:function(t){e.$set(e.kpiForm,"Categories",t)},expression:"kpiForm.Categories"}},e._l(e.params.users,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"Lựa chọn KPIs",prop:"Feature","value-key":"value"}},[a("el-select",{attrs:{placeholder:"Lựa chọn KPIs"},model:{value:e.kpiForm.Feature,callback:function(t){e.$set(e.kpiForm,"Feature",t)},expression:"kpiForm.Feature"}},e._l(e.params.categories,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"Đơn vị tính",prop:"Manager","value-key":"value"}},[a("el-select",{attrs:{placeholder:"Đơn vị tính"},model:{value:e.kpiForm.Manager,callback:function(t){e.$set(e.kpiForm,"Manager",t)},expression:"kpiForm.Manager"}},e._l(e.params.units,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"KPIs kế hoạch",prop:"Planned"}},[a("el-input",{attrs:{placeholder:"KPIs kế hoạch"},model:{value:e.kpiForm.Planned,callback:function(t){e.$set(e.kpiForm,"Planned",t)},expression:"kpiForm.Planned"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"KPIs thực tế",prop:"State"}},[a("el-input",{attrs:{placeholder:"KPIs thực tế"},model:{value:e.kpiForm.State,callback:function(t){e.$set(e.kpiForm,"State",t)},expression:"kpiForm.State"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Tỉ lệ đạt",prop:"Priority"}},[a("el-input",{attrs:{placeholder:"Tỉ lệ đạt"},model:{value:e.kpiForm.Priority,callback:function(t){e.$set(e.kpiForm,"Priority",t)},expression:"kpiForm.Priority"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Loại thời gian",prop:"Milestone","value-key":"value"}},[a("el-select",{attrs:{placeholder:"Loại thời gian"},model:{value:e.kpiForm.Milestone,callback:function(t){e.$set(e.kpiForm,"Milestone",t)},expression:"kpiForm.Milestone"}},e._l(e.params.cycle_times,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"Thời gian bắt đầu",prop:"start_time"}},[a("el-date-picker",{attrs:{type:"date",format:"dd/MM/yyyy",placeholder:"Thời gian bắt đầu"},model:{value:e.kpiForm.PlanStartDate,callback:function(t){e.$set(e.kpiForm,"PlanStartDate",t)},expression:"kpiForm.PlanStartDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"Thời gian kết thúc",prop:"end_time"}},[a("el-date-picker",{attrs:{type:"date",format:"dd/MM/yyyy",placeholder:"Thời gian kết thúc"},model:{value:e.kpiForm.PlanFinishDate,callback:function(t){e.$set(e.kpiForm,"PlanFinishDate",t)},expression:"kpiForm.PlanFinishDate"}})],1),e._v(" "),a("el-form-item",["create"===e.type?a("div",{staticClass:"group-button"},[a("el-button",{attrs:{type:"primary"},on:{click:e.handleCreateTask}},[e._v("\n          Tạo mới\n        ")]),e._v(" "),a("el-button",{on:{click:e.handleCancelCreate}},[e._v("Hủy")])],1):e._e(),e._v(" "),"edit"===e.type?a("div",{staticClass:"group-button tac"},["edit"===e.type?a("el-button",{attrs:{type:"primary"},on:{click:e.handleEditTask}},[e._v("\n          Cập nhật\n        ")]):e._e(),e._v(" "),a("el-button",{on:{click:e.handleCancelEdit}},[e._v("Hủy")])],1):e._e()])],1)],1)},r=[],l={render:i,staticRenderFns:r};t.a=l},1225:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"Kpis__ROOT"},[a("div",{staticClass:"panel__wrapper flex",staticStyle:{"justify-content":"space-between"}},[a("div",{staticClass:"group-button"},[a("el-button",{attrs:{type:"primary"},on:{click:e.handleCreateKpi}},[a("i",{staticClass:"el-icon-plus"})])],1),e._v(" "),a("div",{staticClass:"search mgt5 mgb5"},[a("el-input",{attrs:{"prefix-icon":"el-icon-search",placeholder:"Tìm kiếm"},model:{value:e.keywordSearchKpi,callback:function(t){e.keywordSearchKpi=t},expression:"keywordSearchKpi"}})],1)]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.isSearch?e.searchResult:e.kpis,"highlight-current-row":!0,stripe:"",height:"calc(100vh - 150px)"}},[a("el-table-tree-column",{attrs:{prop:"Name",label:"Tên",levelKey:"level",treeKey:"Id",parentKey:"ParentId"}}),e._v(" "),a("el-table-column",{attrs:{type:"index",width:"40",align:"center","header-align":"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"TypeName",label:"Cấp độ"}}),e._v(" "),a("el-table-column",{attrs:{prop:"StatusName",label:"Đối tượng"}}),e._v(" "),a("el-table-column",{attrs:{prop:"FeatureName",label:"Lựa chọn KPIs",width:"250"}}),e._v(" "),a("el-table-column",{attrs:{prop:"ManagerName",label:"Đơn vị"}}),e._v(" "),a("el-table-column",{attrs:{prop:"Planned",label:"KPIs kế hoạch"}}),e._v(" "),a("el-table-column",{attrs:{prop:"State",label:"KPIs thực tế"}}),e._v(" "),a("el-table-column",{attrs:{prop:"Priority",label:"Tỷ lệ đạt (%)",width:"150px"}}),e._v(" "),a("el-table-column",{attrs:{prop:"MilestoneName",label:"Loại thời gian"}}),e._v(" "),a("el-table-column",{attrs:{prop:"PlanStartDate",label:"Thời gian bắt đầu"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n        "+e._s(new Date(a.PlanStartDate).toLocaleDateString())+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"PlanFinishDate",label:"Thời gian kết thúc"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n        "+e._s(new Date(a.PlanFinishDate).toLocaleDateString())+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"Hành động",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{on:{click:function(a){e.handleEditKpi(t.row.id)}}},[a("i",{staticClass:"fa fa-pencil"})]),e._v(" "),a("el-button",{staticStyle:{margin:"3px 0"},attrs:{type:"danger"},on:{click:function(a){e.deleteKpi(t.row.id)}}},[a("i",{staticClass:"fa fa-trash"})])]}}])})],1),e._v(" "),a("div",{staticClass:"dialog__wrapper"},[a("el-dialog",{attrs:{title:"edit"===e.kpiDialogType?"Chỉnh sửa KPI":"Tạo mới KPI",visible:e.showKpiDialog,width:e.$isMobileDevice?"100%":"70%"},on:{"update:visible":function(t){e.showKpiDialog=t}}},[a("CreateEditKpiDialog",{key:e.kpiEditing&&e.kpiEditing.id,attrs:{type:e.kpiDialogType,kpi:e.kpiEditing,onCreate:e.createKpi,onEdit:e.updateKpi,onCancelCreate:function(){e.showKpiDialog=!1},onCancelEdit:function(){e.showKpiDialog=!1}}})],1)],1)],1)},r=[],l={render:i,staticRenderFns:r};t.a=l},963:function(e,t,a){"use strict";function i(e){a(1217)}Object.defineProperty(t,"__esModule",{value:!0});var r=a(1219),l=a(1225),s=a(0),n=i,o=s(r.a,l.a,!1,n,null,null);t.default=o.exports}});
//# sourceMappingURL=16.3ad74cbd7657d7c20fe3.js.map
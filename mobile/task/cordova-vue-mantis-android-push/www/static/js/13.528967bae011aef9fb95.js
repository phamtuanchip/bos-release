webpackJsonp([13],{1238:function(e,t,o){var a=o(1239);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);o(937)("3847b521",a,!0)},1239:function(e,t,o){t=e.exports=o(936)(!0),t.push([e.i,"","",{version:3,sources:[],names:[],mappings:"",file:"POSes.vue",sourceRoot:""}])},1240:function(e,t,o){"use strict";(function(e){var a=o(4),l=o.n(a),r=o(1241);t.a={name:"POSes",components:{POS:r.a},data:function(){var e={editableTabsValue:"1",editableTabs:[{title:"Hoá đơn 1",name:"1"}],tabIndex:1},t=this.$getItemLocalStorage("POS");return t&&"undefined"!=t&&JSON.parse(t).editableTabs.length>0&&(e=JSON.parse(t)),{model:e}},methods:{handleTabsEdit:function(e,t){var o=this;if("add"===t){var a=++this.model.tabIndex+"";this.model.editableTabs.push({title:"Hoá đơn "+a,name:a}),this.model.editableTabsValue=a}"remove"===t&&this.$confirm("Bạn muốn đóng, dữ liệu chưa lưu có thể bị hủy?","Warning",{cancelButtonText:"Không",confirmButtonText:"Có",type:"warning"}).then(function(){o.$hub.$emit("closeTab",e)}).catch(function(){})},returnProductsToWH:function(t){var o=this;if(t.list){var a=[];a.push(t.orderId);var r={RequestClass:"xBase",RequestAction:"Request",TotalRequests:t.list.length};t.list.filter(function(e,o){a.push(t.list[o].OrderPartId),r["R"+(o+1)+"_RequestFields"]="Id;Code;Priority;UpdateWarehouse;FormSetting;Changed",r["R"+(o+1)+"_Code"]="Warehouse",r["R"+(o+1)+"_RequestTemplate"]="xDocument_Document.Update",r["R"+(o+1)+"_RequestDataGroup"]="DataGroup.warehouse.0fd40",r["R"+(o+1)+"_UpdateWarehouse"]=!0,r["R"+(o+1)+"_Id"]=e.Id,r["R"+(o+1)+"_Priority"]=e.Quantity,r["R"+(o+1)+"_FormSetting"]=t.formSetting;var n=[{ColumnCaption:"Số lượng( Tồn sẵn có)",ColumnName:"Priority",OldDisplayValue:"",OldValue:"",NewDisplayValue:e.Quantity+"",NewValue:e.Quantity+""},{ColumnCaption:"Mã hoá đơn",ColumnName:"FriendlyUrl",OldDisplayValue:"",OldValue:"",NewDisplayValue:t.BillCode,NewValue:""}];r["R"+(o+1)+"_Changed"]=l()(n)}),this.$Utils.postCheckResult(r).then(function(r){if(r.success){var n={RequestClass:"xBase",RequestAction:"Request",TotalRequests:a.length};e.each(a,function(e,t){n["R"+(e+1)+"_RequestTemplate"]="xDocument_Document.Delete",n["R"+(e+1)+"_Id"]=t}),o.$Utils.postCheckResult(n).then(function(e){if(e.success){var a=o.model.editableTabs,r=o.model.editableTabsValue;r===t.targetName&&a.forEach(function(e,o){if(e.name===t.targetName){var l=a[o+1]||a[o-1];l&&(r=l.name)}}),o.model.editableTabsValue=r,o.model.editableTabs=a.filter(function(e){return e.name!==t.targetName}),o.$setItemLocalStorage("POS",l()(o.model));var n=++o.model.tabIndex+"";o.model.editableTabs.push({title:"Hoá đơn "+n,name:n,content:"New Tab content"}),o.model.editableTabsValue=n}})}})}else{var n=this.model.editableTabs,d=this.model.editableTabsValue;if(d===t.targetName&&n.forEach(function(e,o){if(e.name===t.targetName){var a=n[o+1]||n[o-1];a&&(d=a.name)}}),this.model.editableTabsValue=d,this.model.editableTabs=n.filter(function(e){return e.name!==t.targetName}),this.$setItemLocalStorage("POS",l()(this.model)),0==this.model.editableTabs.length){var s=++this.model.tabIndex+"";this.model.editableTabs.push({title:"Hoá đơn "+s,name:s,content:"New Tab content"}),this.model.editableTabsValue=s}}}},created:function(){var e=this;this.$hub.$on("deleteOrder",function(t){e.returnProductsToWH(t)}),this.$hub.$on("saveToLocalStorage",function(){e.$setItemLocalStorage("POS",l()(e.model))})},destroyed:function(){this.$hub.$off("deleteOrder"),this.$hub.$off("saveToLocalStorage"),this.$hub.$off("closeTab")}}}).call(t,o(2))},1241:function(e,t,o){"use strict";function a(e){o(1242)}var l=o(1244),r=o(1245),n=o(0),d=a,s=n(l.a,r.a,!1,d,null,null);t.a=s.exports},1242:function(e,t,o){var a=o(1243);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);o(937)("7b81776a",a,!0)},1243:function(e,t,o){t=e.exports=o(936)(!0),t.push([e.i,'.el-select{display:block}.el-tabs__new-tab{margin-right:20px}.el-date-editor.el-input,.el-date-editor.el-input__inner{width:100%}.Store__ROOT{background:#fff;min-height:"~calc(100vh - 100px)"}.Store__ROOT .col-lg-3,.Store__ROOT .col-lg-4,.Store__ROOT .col-lg-6,.Store__ROOT .col-lg-8,.Store__ROOT .col-lg-9{float:left}.Store__ROOT .block__label{padding:10px;border:1px solid #eee;border-left:0;border-right:0;font-weight:600;background:#f5f7ff}.Store__ROOT .block__wrapper{padding:10px}.Store__ROOT .step__wrapper{padding-top:10px}.Store__ROOT .el-form-item__label{margin-bottom:0;padding-bottom:0}.Store__ROOT .el-step__title{font-size:13px}.Store__ROOT .el-step__icon{font-size:12px;width:18px;height:18px}.Payment__ROOT{border-left:1px solid #999;padding-bottom:20px}.Contact__ROOT .contact__header,.Order__ROOT .contact__header{padding:3px 3px 3px 10px;line-height:27px;background:#f5f7fe}.Contact__ROOT .contact__header .el-input__inner,.Order__ROOT .contact__header .el-input__inner{border:none;background:"#00000008"}.Cart__ROOT .cart__header{padding:3px 3px 3px 10px;line-height:27px;background:#f5f7fe}.Cart__ROOT .cart__header .el-input__inner{border:none;background:"#00000008"}',"",{version:3,sources:["/Users/yuukininomae/Sites/vue-crm3/src/components/static/POS/POS.vue"],names:[],mappings:"AACA,WACE,aAAe,CAChB,AACD,kBACE,iBAAmB,CACpB,AACD,yDACE,UAAY,CACb,AACD,aACE,gBAAiB,AACjB,iCAAmC,CACpC,AACD,mHACI,UAAY,CACf,AACD,2BACI,aAAc,AACd,sBAAuB,AACvB,cAAe,AACf,eAAgB,AAChB,gBAAiB,AACjB,kBAAoB,CACvB,AACD,6BACI,YAAc,CACjB,AACD,4BACI,gBAAkB,CACrB,AACD,kCACI,gBAAiB,AACjB,gBAAkB,CACrB,AACD,6BACI,cAAgB,CACnB,AACD,4BACI,eAAgB,AAChB,WAAY,AACZ,WAAa,CAChB,AACD,eACE,2BAA4B,AAC5B,mBAAqB,CACtB,AACD,8DACE,yBAA0B,AAC1B,iBAAkB,AAClB,kBAAoB,CACrB,AACD,gGACI,YAAa,AACb,sBAAwB,CAC3B,AACD,0BACE,yBAA0B,AAC1B,iBAAkB,AAClB,kBAAoB,CACrB,AACD,2CACI,YAAa,AACb,sBAAwB,CAC3B",file:"POS.vue",sourcesContent:['\n.el-select {\n  display: block;\n}\n.el-tabs__new-tab {\n  margin-right: 20px;\n}\n.el-date-editor.el-input, .el-date-editor.el-input__inner {\n  width: 100%;\n}\n.Store__ROOT {\n  background: #fff;\n  min-height: "~calc(100vh - 100px)";\n}\n.Store__ROOT .col-lg-8, .Store__ROOT .col-lg-4, .Store__ROOT .col-lg-6, .Store__ROOT .col-lg-9, .Store__ROOT .col-lg-3 {\n    float: left;\n}\n.Store__ROOT .block__label {\n    padding: 10px;\n    border: solid 1px #eee;\n    border-left: 0;\n    border-right: 0;\n    font-weight: 600;\n    background: #f5f7ff;\n}\n.Store__ROOT .block__wrapper {\n    padding: 10px;\n}\n.Store__ROOT .step__wrapper {\n    padding-top: 10px;\n}\n.Store__ROOT .el-form-item__label {\n    margin-bottom: 0;\n    padding-bottom: 0;\n}\n.Store__ROOT .el-step__title {\n    font-size: 13px;\n}\n.Store__ROOT .el-step__icon {\n    font-size: 12px;\n    width: 18px;\n    height: 18px;\n}\n.Payment__ROOT {\n  border-left: solid 1px #999;\n  padding-bottom: 20px;\n}\n.Contact__ROOT .contact__header, .Order__ROOT .contact__header {\n  padding: 3px 3px 3px 10px;\n  line-height: 27px;\n  background: #f5f7fe;\n}\n.Contact__ROOT .contact__header .el-input__inner, .Order__ROOT .contact__header .el-input__inner {\n    border: none;\n    background: "#00000008";\n}\n.Cart__ROOT .cart__header {\n  padding: 3px 3px 3px 10px;\n  line-height: 27px;\n  background: #f5f7fe;\n}\n.Cart__ROOT .cart__header .el-input__inner {\n    border: none;\n    background: "#00000008";\n}\n'],sourceRoot:""}])},1244:function(e,t,o){"use strict";(function(e,a){var l=o(4),r=o.n(l);t.a={name:"POS",components:{},props:["item"],data:function(){var e={disabled:!1,formSetting:{contact:"",lead:"",order:"",orderPart:"",warehouse:""},posModel:{seller:{Id:JSON.parse(localStorage.getItem("LoggedOnUser")).UserId,Name:JSON.parse(localStorage.getItem("LoggedOnUser")).Username,LoginName:JSON.parse(localStorage.getItem("LoggedOnUser")).LoginName},pos:""},paymentModel:{sum_of_payment:"0",cash:"0",change:"0",customerCard:"0",bankMoney:"0",gaveMoney:"0"},contactModel:{Id:"",CustomerCode:"",Source:{},Birthday:"",Address:"",CampaignCode:{},Location:{},Gender:{},OfficialNumber:""},orderModel:{Id:"",Created:this.$Utils.formatDateTime(new Date),TimeFrame:{},BillCode:"",Warehouse:{},Name:"",Phone:"",MetaDescription:"",IsProcessing:!1},contact_search_keyword:"",barcode_search_keyword:"",showEditProductModal:!1,productEditing:{},cart:[],params:{sources:[],genders:[],campaignCodes:[],timeFrameNames:[],provinces:[],poses:[],users:[],customers:[],warehouses:[]},contactRules:{CustomerCode:[{required:!0,message:"Bắt buộc",trigger:"blur"}],CampaignCode:[{required:!0,message:"Bắt buộc",trigger:"change"}],OfficialNumber:[{required:!0,message:"Bắt buộc",trigger:"blur"}]},orderRules:{Name:[{required:!0,message:"Bắt buộc",trigger:"blur"},{min:5,max:50,message:"Độ dài phải từ 5 đến 50 kí tự",trigger:"blur"}],Phone:[{required:!0,message:"Bắt buộc",trigger:"blur"},{min:10,max:11,message:"Độ dài phải là 10 hoặc 11 kí tự",trigger:"blur"}],Created:[{required:!0,message:"Bắt buộc",trigger:"blur"}],TimeFrame:[{required:!0,message:"Bắt buộc",trigger:"change"}],BillCode:[{required:!0,message:"Bắt buộc",trigger:"blur"}]},posRules:{pos:[{required:!0,message:"Bắt buộc",trigger:"change"}],seller:[{required:!0,message:"Bắt buộc",trigger:"change"}]},paymentRules:{},cachedContact:{},contactFields:{Name:{Caption:"Tên khách hàng"},IdentityCode:{Caption:"Mã khách hàng"},LeadSource:{Caption:"Nguồn khách hàng"},Phone:{Caption:"SĐT KH 1"},Birthday:{Caption:"Năm sinh"},Location:{Caption:"Tỉnh thành"},Gender:{Caption:"Giới tính"}},leadFields:{Store:{Caption:"Cửa hàng"},CreatedBy:{Caption:"Người tạo"},ModifiedBy:{Caption:"Người sửa"},Name:{Caption:"Tên khách hàng"},Phone:{Caption:"SĐT KH1"},TimeFrame:{Caption:"Khung giờ"},OfficialNumber:{Caption:"Mã lượt liên hệ"},Author:{Caption:"Nhân viên bán hàng"},Source:{Caption:"Nguồn khách hàng"},CampaignCode:{Caption:"Mã chiến dịch"},CustomerCode:{Caption:"Mã khách hàng"}},orderFields:{CreatedBy:{Caption:"Người tạo"},ModifiedBy:{Caption:"Người sửa"},Store:{Caption:"Cửa hàng"},Name:{Caption:"Tên khách hàng"},Birthday:{Caption:"Năm sinh"},Phone:{Caption:"SĐT KH1"},TimeFrame:{Caption:"Khung giờ"},BillCode:{Caption:"Mã hoá đơn"},OfficialNumber:{Caption:"Mã lượt liên hệ"},Author:{Caption:"Nhân viên bán hàng"},Source:{Caption:"Nguồn khách hàng"},CampaignCode:{Caption:"Mã chiến dịch"},CustomerCode:{Caption:"Mã khách hàng"},Location:{Caption:"Tỉnh thành"}},orderPartFields:{CreatedBy:{Caption:"Người tạo"},ModifiedBy:{Caption:"Người sửa"},Store:{Caption:"Cửa hàng"},Name:{Caption:"Tên khách hàng"},Birthday:{Caption:"Năm sinh"},Phone:{Caption:"SĐT KH1"},TimeFrame:{Caption:"Khung giờ"},BillCode:{Caption:"Mã hoá đơn"},OfficialNumber:{Caption:"Mã lượt liên hệ"},Author:{Caption:"Nhân viên bán hàng"},Source:{Caption:"Nguồn khách hàng"},CampaignCode:{Caption:"Mã chiến dịch"},CustomerCode:{Caption:"Mã khách hàng"},ProductCode:{Caption:"Mã Sản phẩm"},ProductType:{Caption:"Dòng Sản phẩm"},ProductPrice:{Caption:"Đơn giá"},Price:{Caption:"Giá trị đơn hàng"},ProductColor:{Caption:"Màu sắc"},ProductSize:{Caption:"Size"},Category:{Caption:"Xuất từ kho"},Location:{Caption:"Tỉnh thành"},DiscountMoney:{Caption:"Chiết khấu (bằng hình thức số tiền)"},DiscountPercent:{Caption:"Chiết khấu (bằng hình thức %)"},ProductCount:{Caption:"Số lượng"},Total:{Caption:"Tổng thanh toán"},Status:{Caption:"Loại đơn hàng (Bán/ Đổi)"},DeliveryStatus:{Caption:"Tình trạng vận đơn"},PaymentStatus:{Caption:"Tình trạng thanh toán"},ProductUnit:{Caption:"Đơn vị tính"},ProductShopCode:{Caption:"Mã hàng"},MetaKeywords:{Caption:"Barcode"}},fieldMappingPrinter:{BillCode:"model.orderModel.BillCode",Name:"model.orderModel.Name",Phone:"model.orderModel.Phone",Address:"model.contactModel.Address",Barcode:"MetaKeywords.loopVal",ProductCode:"ProductCode.loopVal",ProductCount:"Quantity.loopVal",Total:"Total.loopVal",TotalPages:"model.paymentModel.customerCard",ProductPrice:"TotalPages.loopVal",TotalComments:"model.paymentModel.gaveMoney",TotalDownloads:"model.paymentModel.cash",TotalRatingPoints:"model.paymentModel.bankMoney",TotalRatings:"model.paymentModel.change",DiscountPercent:"DiscountPercent.loopVal",DiscountMoney:"DiscountMoney.loopVal",Price:"model.paymentModel.sum_of_payment","DataGroup.pointofsales.09egb.Description":"model.posModel.pos.Description",Created:"model.orderModel.Created","User.LoginName":"model.posModel.seller.LoginName"},passedItem:this.item,campaignId:void 0};return{model:this.$getItemLocalStorage("BILL"+this.item.name)&&"undefined"!=this.$getItemLocalStorage("BILL"+this.item.name)?JSON.parse(this.$getItemLocalStorage("BILL"+this.item.name)):e}},methods:{loadResources:function(){var t=this,o={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestDataGroup:"DataGroup.warehouses.01dh7",R1_RequestFields:"Id;Code;Name;",R1_Code:"Warehouses",R1_RequestTemplate:"xDocument_Document.Search"};this.$Utils.post(o).then(function(o){t.model.params.warehouses=t.$Utils.getDataWithRoot(o.R1,"Data.DocumentDS.Document");var a={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestDataGroup:"DataGroup.pointofsales.09egb",R1_RequestFields:"Id;Code;Promulgator;Name;Category;Type;Description",R1_Code:"POS",R1_RequestTemplate:"xDocument_Document.Search"};t.$Utils.post(a).then(function(o){t.model.params.poses=t.$Utils.getDataWithRoot(o.R1,"Data.DocumentDS.Document"),e.each(t.model.params.warehouses,function(e,o){if(o.Id==t.model.params.poses[0].Category)return t.model.orderModel.Warehouse=o,!1})})});var a={RequestAction:"SearchUsers",RequestClass:"BPM",ConditionFields:"IncludedGroupManager;Group;Status;LoginName;UserId,Status",StaticFields:"UserId;Username;Description;Status;LoginName",DynamicFields:"Avatar;Facebook;Email;Skype;Birthday;Biography;WorkProcess;Telephone",StructFields:"GroupRoot;GroupRootName;PhoneId;PhoneGroup;Public;RoleRootName;GroupManage;Notification",Status:1};this.$Utils.post(a).then(function(o){t.model.params.users=[],o=t.$Utils.getDataWithRoot(o,"Data.UserDS.User"),e.each(o,function(e,o){"superadmin"!==o.LoginName&&t.model.params.users.push({Id:o.UserId,Name:o.LoginName})})});var l={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestTemplate:"Setting.SearchBase",R1_ParentCode:"xSetting.Project.Parameter.CRM.Customer.Source"};this.isMobile=this.$isMobileDevice,this.$Utils.post(l).then(function(e){t.model.params.sources=t.$Utils.getDataWithRoot(e.R1,"Data.DynamicDS.Setting")});var l={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestTemplate:"xDocument_Document.Search",R1_RequestDataGroup:"DataGroup.campaign.0d1gf",R1_RequestFields:"Id;Code;Name;",R1_Code:"Campaign"};this.isMobile=this.$isMobileDevice,this.$Utils.post(l).then(function(e){t.model.params.campaignCodes=t.$Utils.getDataWithRoot(e.R1,"Data.DocumentDS.Document"),t.model.campaignId=t.model.params.campaignCodes[0].Id});var l={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestTemplate:"Setting.SearchBase",R1_ParentCode:"xSetting.Project.Parameter.CRM.Activity.TimeFrame"};this.isMobile=this.$isMobileDevice,this.$Utils.post(l).then(function(e){t.model.params.timeFrameNames=t.$Utils.getDataWithRoot(e.R1,"Data.DynamicDS.Setting")});var l={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestTemplate:"Setting.SearchBase",R1_ParentCode:"xSetting.Project.Parameter.CRM.Customer.Gender"};this.isMobile=this.$isMobileDevice,this.$Utils.post(l).then(function(e){t.model.params.genders=t.$Utils.getDataWithRoot(e.R1,"Data.DynamicDS.Setting")});var l={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestTemplate:"Setting.SearchBase",R1_ParentCode:"xSetting.Project.Parameter.CRM.Lead.Province"};this.isMobile=this.$isMobileDevice,this.$Utils.post(l).then(function(e){t.model.params.provinces=t.$Utils.getDataWithRoot(e.R1,"Data.DynamicDS.Setting")})},handleUpdateProduct:function(){var e=this;this.$set(this.model.cart,this.model.cart.findIndex(function(t){return t.Id===e.model.productEditing.Id}),this.model.productEditing),this.handleCloseEditProductModal()},handleEditProduct:function(e){this.model.productEditing=this.model.cart.filter(function(t){return t.Id===e})[0],this.model.productEditing=JSON.parse(r()(this.model.productEditing)),this.model.showEditProductModal=!0},handleDeleteProduct:function(e,t){var o=this,a=this.$Lodash.cloneDeep(this.model.cart);this.model.cart=this.model.cart.filter(function(t){return t.Id!==e});var l={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1},n={},d=this.$Lodash.cloneDeep(JSON.parse(this.model.formSetting.warehouse));this.$Utils.replacePermission(d,n),l.R1_RequestFields="Id;Code;Priority;UpdateWarehouse;FormSetting;Changed",l.R1_Code="Warehouse",l.R1_RequestTemplate="xDocument_Document.Update",l.R1_RequestDataGroup="DataGroup.warehouse.0fd40",l.R1_UpdateWarehouse=!0,l.R1_Id=t.Id,l.R1_Priority=t.Quantity,l.R1_FormSetting=r()(d);var s=[{ColumnCaption:"Số lượng( Tồn sẵn có)",ColumnName:"Priority",OldDisplayValue:"",OldValue:"",NewDisplayValue:t.Quantity+"",NewValue:t.Quantity+""},{ColumnCaption:"Mã hoá đơn",ColumnName:"FriendlyUrl",OldDisplayValue:"",OldValue:"",NewDisplayValue:this.model.orderModel.BillCode,NewValue:""}];l.R1_Changed=r()(s),this.$Utils.postCheckResult(l).then(function(e){if(e.success){o.$message.success("Trả tồn thành công");var l={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestTemplate:"xDocument_Document.Delete",R1_Id:t.OrderPartId};o.$Utils.postCheckResult(l).then(function(e){e.success?(o.$message.success("Xoá thành công"),o.$setItemLocalStorage("BILL"+o.item.name,r()(o.model))):o.$message.error("Có lỗi, không xoá được")})}else o.$message.error("Có lỗi, không trả tồn"),o.model.cart=a})},handleCloseEditProductModal:function(){this.model.productEditing={},this.model.showEditProductModal=!1},computeTotalMoney:function(){this.model.productEditing.Total=parseInt((this.model.productEditing.ProductPrice-(this.model.productEditing.DiscountMoney||0))*(100-(this.model.productEditing.DiscountPercent||0))/100)*(this.model.productEditing.Quantity||1)},saveSingleOrderPart:function(e,t,o){var a=this,l={RequestClass:"xBase",RequestAction:"Request",TotalRequests:this.model.cart.length};l.R1_RequestFields="Id;Code;CreatedByName;ModifiedByName;Code;Store;StoreName;Name;Birthday;Phone;TimeFrame;TimeFrameName;BillCode;OfficialNumber;Author;AuthorName;Source;SourceName;CampaignCode;CampaignCodeName;CustomerCode;ProductCode;Parent;OrderId;ProductType;ProductTypeName;ProductPrice;Price;ProductColor;ProductColorName;ProductSize;ProductSizeName;Category;CategoryName;ProductCount;Total;Priority;Status;MetaDescription;DeliveryStatus;DeliveryStatusName;PaymentStatus;PaymentStatusName;ProductUnit;ProductShopCode;Barcode;LocationName;DiscountMoney;DiscountPercent;Address;GroupId;FormSetting;Changed;",l.R1_RequestDataGroup="DataGroup.orderpart.82fjy",o?(l.R1_RequestTemplate="xDocument_Document.Update",l.R1_Id=t.OrderPartId):l.R1_RequestTemplate="xDocument_Document.Insert",l.R1_CreatedBy=JSON.parse(localStorage.getItem("LoggedOnUser")).UserId,l.R1_CreatedByName=JSON.parse(localStorage.getItem("LoggedOnUser")).Username,l.R1_ModifiedBy=JSON.parse(localStorage.getItem("LoggedOnUser")).UserId,l.R1_ModifiedByName=JSON.parse(localStorage.getItem("LoggedOnUser")).Username,l.R1_Code="OrderPart",l.R1_GroupId=this.model.posModel.pos.Promulgator,l.R1_Store=this.model.posModel.pos.Id,l.R1_StoreName=this.model.posModel.pos.Name,l.R1_Author=this.model.posModel.seller.Id,l.R1_AuthorName=this.model.posModel.seller.Name,l.R1_ProductCode=t.ProductCode,l.R1_Parent=e,l.R1_OrderId=e,l.R1_ProductType=t.Categories,l.R1_ProductTypeName=t.CategoriesName,l.R1_ProductPrice=t.TotalPages,l.R1_ProductColor=t.ProductColor,l.R1_ProductColorName=t.ProductColorName,l.R1_ProductSize=t.Size,l.R1_ProductSizeName=t.SizeName,l.R1_Category=this.model.orderModel.Warehouse.Id,l.R1_CategoryName=this.model.orderModel.Warehouse.Name,l.R1_LocationName=this.model.contactModel.Location.Name,l.R1_Address=this.model.contactModel.Address,l.R1_DiscountMoney=t.DiscountMoney,l.R1_DiscountPercent=t.DiscountPercent,l.R1_Gender=this.model.contactModel.Gender.Id,l.R1_GenderName=this.model.contactModel.Gender.Name,l.R1_ProductCount=t.Quantity,l.R1_Total=(parseInt(t.TotalPages)-(isNaN(parseInt(t.DiscountMoney))?0:parseInt(t.DiscountMoney))-(isNaN(parseInt(t.DiscountPercent))?0:parseInt(t.DiscountPercent)/100*parseInt(t.TotalPages)))*parseInt(t.Quantity),l.R1_Priority=0,l.R1_Status="be311afe-985d-4f79-8e89-c895a4ff0694",l.R1_ProductUnit=t.SourceUrl,l.R1_ProductShopCode=t.MetaDescriptionName,l.R1_Barcode=t.MetaKeywords,l.R1_Name=this.model.orderModel.Name,l.R1_Phone=this.model.orderModel.Phone,l.R1_BillCode=this.model.orderModel.BillCode,l.R1_OfficialNumber=this.model.contactModel.OfficialNumber,l.R1_CampaignCode=this.model.contactModel.CampaignCode.Id,l.R1_CampaignCodeName=this.model.contactModel.CampaignCode.Name,this.$Utils.post(l).then(function(e){e.success&&(t.OrderPartId=e.R1.Data,a.$setItemLocalStorage("BILL"+a.item.name,r()(a.model)),a.$hub.$emit("saveToLocalStorage"))})},handleBarcodeSearchConfirm:function(){var e=this;this.$Utils.equals(this.model.orderModel.Warehouse,{})?this.$message({message:"Phải chọn kho hàng trước",center:!0,type:"error"}):""==this.model.barcode_search_keyword||this.$refs.contactForm.validate(function(t){e.$refs.orderForm.validate(function(o){e.$refs.posForm.validate(function(a){e.$refs.paymentForm.validate(function(l){if(t&&o&&a&&l){var n=e.$Lodash.cloneDeep(e.model.barcode_search_keyword);e.model.barcode_search_keyword="";var d={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestDataGroup:"DataGroup.order.9ejnl",R1_RequestFields:"Id;Name;BillCode;",R1_Code:"Order",R1_RequestTemplate:"xDocument_Document.Search",R1_BillCode:e.model.orderModel.BillCode};e.$Utils.post(d).then(function(t){if(t.success){var o=e.$Utils.getDataWithRoot(t.R1,"Data.DocumentDS.Document");if(o.length>1||""==e.model.orderModel.Id&&1==o.length||""!=e.model.orderModel.Id&&1==o.length&&o[0].Id!=e.model.orderModel.Id)e.$message.error("Mã hoá đơn đã tồn tại");else{var a={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestDataGroup:"DataGroup.warehouse.0fd40",R1_RequestFields:"Id;Name;MetaDescription;MetaDescriptionName;Priority;ProductCode;OfficialNumber;ProductColor;Size;Style;ProductColorName;SizeName;MetaKeywords;CodeName;TotalPages;Category;CategoryName;Unit;FullCodeName;ProductShopCode;ProductCode;Status;Categories;CategoriesName",R1_Code:"Warehouse",R1_MetaKeywords:n,R1_Status:e.model.orderModel.Warehouse.Id,R1_RequestTemplate:"xDocument_Document.Search"};e.$Utils.post(a).then(function(t){var o=e.$Utils.getDataWithRoot(t.R1,"Data.DocumentDS.Document");if(o&&1==o.length)if(o[0].Priority>0){var a={},l=e.$Lodash.cloneDeep(JSON.parse(e.model.formSetting.warehouse));e.$Utils.replacePermission(l,a);var n={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestFields:"Id;Code;TotalAttachments;Priority;UpdateWarehouse;FormSetting;Changed",R1_Code:"Warehouse",R1_RequestTemplate:"xDocument_Document.Update",R1_RequestDataGroup:"DataGroup.warehouse.0fd40",R1_UpdateWarehouse:!0,R1_Id:o[0].Id,R1_Priority:-1,R1_FormSetting:r()(l)},d=[{ColumnCaption:"Số lượng( Tồn sẵn có)",ColumnName:"Priority",OldDisplayValue:"",OldValue:"",NewDisplayValue:-1,NewValue:-1},{ColumnCaption:"Mã hoá đơn",ColumnName:"FriendlyUrl",OldDisplayValue:"",OldValue:"",NewDisplayValue:e.model.orderModel.BillCode,NewValue:""}];n.R1_Changed=r()(d),e.$Utils.postCheckResult(n).then(function(t){if(1==t.R1.success){var a=!1;if(e.model.cart.forEach(function(t){if(t.MetaKeywords==o[0].MetaKeywords)return a=!0,t.Quantity=parseInt(t.Quantity)+1,e.saveSingleOrderPart(e.model.orderModel.Id,t,!0),!1}),!a){var l=o[0];if(l.Quantity=1,e.model.cart.push(l),""==e.model.orderModel.Id){var r={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestFields:"Id;Code;CreatedByName;Phone;ModifiedByName;Code;Store;StoreName;Name;TimeFrame;TimeFrameName;BillCode;OfficialNumber;Author;AuthorName;Source;SourceName;CampaignCode;CampaignCodeName;CustomerCode;Birthday;MetaDescription;Location;LocationName;TotalComments;TotalDownloads;TotalPages;TotalRatingPoints;TotalRatings;Status;StatusName;MetaDescription;PaymentStatus;PaymentStatusName;Address;Priority;GroupId;FormSetting;Changed;",R1_RequestDataGroup:"DataGroup.order.9ejnl",R1_RequestTemplate:"xDocument_Document.Insert",R1_CreatedBy:JSON.parse(localStorage.getItem("LoggedOnUser")).UserId,R1_CreatedByName:JSON.parse(localStorage.getItem("LoggedOnUser")).Username,R1_ModifiedBy:JSON.parse(localStorage.getItem("LoggedOnUser")).UserId,R1_ModifiedByName:JSON.parse(localStorage.getItem("LoggedOnUser")).Username,R1_Code:"Order",R1_GroupId:e.model.posModel.pos.Promulgator,R1_Store:e.model.posModel.pos.Id,R1_StoreName:e.model.posModel.pos.Name,R1_Status:"be311afe-985d-4f79-8e89-c895a4ff0694",R1_StatusName:"Bán",R1_Name:e.model.orderModel.Name,R1_Phone:e.model.orderModel.Phone,R1_BillCode:e.model.orderModel.BillCode,R1_CampaignCode:e.model.contactModel.CampaignCode.Id,R1_CampaignCodeName:e.model.contactModel.CampaignCode.Name,R1_CustomerCode:e.model.contactModel.CustomerCode,R1_Author:e.model.posModel.seller.Id,R1_AuthorName:e.model.posModel.seller.Name,R1_OfficialNumber:e.model.contactModel.OfficialNumber,R1_Priority:1};e.$Utils.post(r).then(function(t){e.model.orderModel.Id=t.R1.Data,e.saveSingleOrderPart(e.model.orderModel.Id,l)})}else e.saveSingleOrderPart(e.model.orderModel.Id,l)}}else e.$message({message:"Xin hãy kiểm tra số lượng tồn trong hệ thống",center:!0,type:"error"})})}else e.$message({message:"Hết hàng",center:!0,type:"warning"});else o&&0==o.length?e.$message({message:"Không có barcode này",type:"warning",center:!0}):e.$message({message:"Lỗi hệ thống, liên hệ quản trị viên để xử lý",center:!0,type:"error"})})}}})}})})})})},format_currency:function(e){return void 0==e?0:isNaN(parseInt(e))?"0":(e=(""+e).replaceAll(".",""),e=parseInt(e),(e+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1."))},onCustomerCashChange:function(){var e=parseInt((this.model.paymentModel.gaveMoney+"").replaceAll(".","")),t=parseInt((parseInt((this.model.paymentModel.sum_of_payment+"").replaceAll(".",""))+"").replaceAll(".",""));if(isNaN(e)||isNaN(t))this.model.paymentModel.change="0";else{var o=e-t;this.model.paymentModel.change=this.format_currency(o)}},getFormSetting:function(t,o){var l=this,n=this.$Lodash.cloneDeep(this.$singleRequest);n.R1_RequestTemplate="SettingNew.SearchSetting",n.R1_Code=o,this.$Utils.post(n).then(function(o){o=l.$Utils.getDataWithRoot(o.R1,"Data.DynamicDS.Setting");for(var n=0;n<o.length;n++){var d=o[n];if(d.Description=d.Description?JSON.parse(d.Description):"",l.$Utils.isEmpty(d,"F1")){d.Description.Fields="";for(var n=1;n<=d.Description.FCount;n++)void 0!=d["F"+n]&&(d.Description.Fields+=d["F"+n],delete d["F"+n]);d.Description.Fields="string"==typeof d.Description.Fields?JSON.parse(d.Description.Fields):[]}d.Description.Code=d.Code,d.Description.DataGroup=d.Name,d.Description.Value=d.Value,d.Description.ModuleType=a.ModuleType,"Filter"==a.ModuleType&&(d.Description.functions||(d.Description.functions={}),d.Description.functions.onFilter=l.model.onFilter)}var s=l.$Lodash.cloneDeep(o);e.each(s.Fields,function(e,t){"Select"!==t.ElementType&&"Multi"!==t.ElementType&&"Radio"!==t.ElementType&&"Tree"!==t.ElementType&&"MultiTree"!==t.ElementType&&"Autocomplete"!==t.ElementType||(delete t.Data,delete t.treeData,delete t.sourceData)}),e.each(s.Permissions,function(t,o){if(l.$Utils.isEmpty(o.Permissions))if(s.Permissions[t].Permissions=l.$Utils.stringToObject(o.Permissions),"Script"!=o.Name&&"Static"!=o.Name)for(var a=1;l.$Utils.isEmpty(o.Permissions["Value"+a]);)s.Permissions[t].Permissions["Value"+a]=sourceData[o.Permissions["Value"+a]],a++;else"Script"==o.Name&&(s.Permissions[t].LeadershipDynamicOrganization=sourceData[s.Permissions[t].LeadershipDynamicOrganization]);else if("Replica"==o.Name){var r=l.$Lodash.cloneDeep(s.Permissions[t].DynamicPermissions.split(";"));s.Permissions[t].DynamicPermissions="",e.each(r,function(e,o){""!=o&&l.$Utils.isEmpty(sourceData[o])&&(s.Permissions[t].DynamicPermissions+=sourceData[o]+";")}),l.$Utils.isEmpty(s.Permissions[t].FormCode)&&l.$Utils.isEmpty(sourceData.StatusDisplay)&&(s.Permissions[t].StatusDisplay=sourceData.StatusDisplay)}}),l.model.formSetting[t]=r()(s[0].Description)})},calculateOrderCash:function(t){var o=this,a=0;0==t.length?(this.model.paymentModel.sum_of_payment=0,this.onCustomerCashChange()):e.each(t,function(e,t){var l="";l=void 0==t.TotalPages||isNaN(parseInt(t.TotalPages))?0:(parseInt(t.TotalPages)-(isNaN(parseInt(t.DiscountMoney))?0:parseInt(t.DiscountMoney))-(isNaN(parseInt(t.DiscountPercent))?0:parseInt(t.DiscountPercent)/100*parseInt(t.TotalPages)))*parseInt(t.Quantity),a+=l,o.model.paymentModel.sum_of_payment=o.format_currency(a),o.onCustomerCashChange()})},querySearch:function(e,t){var o=this,a={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestDataGroup:"DataGroup.contact.82fhd",R1_RequestFields:"Id;Code;CreatedByName;ModifiedByName;IdentityCode;Name;TimeFrame;TimeFrameName;LeadSource;LeadSourceName;Phone;Birthday;Keyword;;Location;LocationName;Gender;GenderName;Birthday;",R1_Code:"Contact",R1_RequestTemplate:"xProfile_Profile.Search",R1_StartIndex:0,R1_EndIndex:20,R1_Keyword:this.model.contact_search_keyword};this.$Utils.post(a).then(function(e){e=o.$Utils.getDataWithRoot(e.R1,"Data.ProfileDS.Profile"),t(e)})},handleSelect:function(e){this.model.contactModel.Id=e.Id,this.model.orderModel.Name=e.Name,this.model.contactModel.CustomerCode=e.IdentityCode,this.model.contactModel.Source={Id:e.LeadSource,Name:e.LeadSourceName},this.model.orderModel.Phone=e.Phone,this.model.contactModel.Birthday=e.Birthday,this.model.contactModel.Location={Id:e.Location,Name:e.LocationName},this.model.contactModel.Gender={Id:e.Gender,Name:e.GenderName},this.model.orderModel.TimeFrame={Id:e.TimeFrame,Name:e.TimeFrameName};var t={Id:e.Id,Name:e.Name,IdentityCode:e.IdentityCode,LeadSource:e.LeadSource,LeadSourceName:e.LeadSourceName,Phone:e.Phone,Birthday:e.Birthday,Location:e.Location,LocationName:e.LocationName,Gender:e.Gender,GenderName:e.GenderName,TimeFrame:e.TimeFrame,TimeFrameName:e.TimeFrameName};this.model.cachedContact=this.$Lodash.cloneDeep(t)},save:function(){var t=this;this.model.orderModel.Created=this.$Utils.formatDateTime(new Date);var o=new Date(this.model.orderModel.Created).getHours();e.each(this.model.params.timeFrameNames,function(e,a){var l=a.Name.split(" - ");if(parseInt(l[0])<o&&parseInt(l[1])>o)return t.model.orderModel.TimeFrame=a,!1}),this.$refs.contactForm.validate(function(o){t.$refs.orderForm.validate(function(a){t.$refs.posForm.validate(function(l){t.$refs.paymentForm.validate(function(n){if(0==t.model.cart.length)return t.$message.error("Giỏ hàng trống"),!1;if(t.model.paymentModel.change<0)return t.$message.error("Tiền trả lại không đúng"),!1;if(!(n&&l&&a&&o))return console.log("error submit!!"),!1;var d={RequestClass:"xBase",RequestAction:"Request",TotalRequests:2,R1_RequestDataGroup:"DataGroup.lead.9jwnc",R1_RequestFields:"Id;Name;OfficialNumber;",R1_Code:"Lead",R1_RequestTemplate:"xDocument_Document.Search",R1_OfficialNumber:t.model.contactModel.OfficialNumber,R2_RequestDataGroup:"DataGroup.order.9ejnl",R2_RequestFields:"Id;Name;BillCode;",R2_Code:"Order",R2_RequestTemplate:"xDocument_Document.Search",R2_BillCode:t.model.orderModel.BillCode};""==t.model.contactModel.Id&&(d.TotalRequests=3,d.R3_RequestFields="Id;Code;IdentityCode;",d.R3_RequestDataGroup="DataGroup.contact.82fhd",d.R3_Code="Contact",d.R3_RequestTemplate="xProfile_Profile.Search",d.R3_IdentityCode=t.model.contactModel.CustomerCode),t.$Utils.post(d).then(function(o){var a="",l=t.$Utils.getDataWithRoot(o.R1,"Data.DocumentDS.Document"),n=t.$Utils.getDataWithRoot(o.R2,"Data.DocumentDS.Document");if(3==d.TotalRequests){t.$Utils.getDataWithRoot(o.R3,"Data.ProfileDS.Profile").length>0&&(a+="mã khách hàng,")}if(l.length>0&&(a+=" mã lượt liên hệ,"),n.length>1&&(a+=" mã hoá đơn,"),""!=a)a=a.substring(0,a.length-1)+" đã tồn tại",t.$message.error(a);else{var s={RequestClass:"xBase",RequestAction:"Request",TotalRequests:t.model.cart.length},i={},c=t.$Lodash.cloneDeep(JSON.parse(t.model.formSetting.warehouse));t.$Utils.replacePermission(c,i),e.each(t.model.cart,function(e,o){s["R"+(e+1)+"_RequestFields"]="Id;Code;TotalAttachments;Priority;UpdateWarehouse;FormSetting;Changed",s["R"+(e+1)+"_Code"]="Warehouse",s["R"+(e+1)+"_RequestTemplate"]="xDocument_Document.Update",s["R"+(e+1)+"_RequestDataGroup"]="DataGroup.warehouse.0fd40",s["R"+(e+1)+"_UpdateWarehouse"]=!0,s["R"+(e+1)+"_Id"]=o.Id,s["R"+(e+1)+"_TotalAttachments"]=-o.Quantity,s["R"+(e+1)+"_FormSetting"]=r()(c);var a=[{ColumnCaption:"Số lượng (Tồn thực thế)",ColumnName:"TotalAttachments",OldDisplayValue:"",OldValue:"",NewDisplayValue:-o.Quantity+"",NewValue:-o.Quantity+""},{ColumnCaption:"Mã hoá đơn",ColumnName:"FriendlyUrl",OldDisplayValue:"",OldValue:"",NewDisplayValue:t.model.orderModel.BillCode,NewValue:""}];s["R"+(e+1)+"_Changed"]=r()(a)}),t.$Utils.post(s).then(function(e){});var i={},c=t.$Lodash.cloneDeep(JSON.parse(t.model.formSetting.contact));t.$Utils.replacePermission(c,i);var m={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestFields:"Id;Code;Address;CreatedByName;ModifiedByName;IdentityCode;Name;Gender;GenderName;Phone;LeadSource;LeadSourceName;Location;LocationName;Birthday;FormSetting;Changed;",R1_RequestDataGroup:"DataGroup.contact.82fhd",R1_ModifiedByName:JSON.parse(localStorage.getItem("LoggedOnUser")).Username,R1_Code:"Contact",R1_Name:t.model.orderModel.Name,R1_Birthday:t.$Utils.formatDateTime(t.model.contactModel.Birthday),R1_Phone:t.model.orderModel.Phone,R1_Gender:t.model.contactModel.Gender.Id,R1_GenderName:t.model.contactModel.Gender.Name,R1_LeadSource:t.model.contactModel.Source.Id,R1_LeadSourceName:t.model.contactModel.Source.Name,R1_Location:t.model.contactModel.Location.Id,R1_LocationName:t.model.contactModel.Location.Name,R1_Address:t.model.contactModel.Address,R1_IdentityCode:t.model.contactModel.CustomerCode,R1_FormSetting:r()(c)};""==t.model.contactModel.Id?(m.R1_RequestTemplate="xProfile_Profile.Insert",m.R1_CreatedByName=JSON.parse(localStorage.getItem("LoggedOnUser")).Username):(m.R1_RequestTemplate="xProfile_Profile.Update",m.R1_Id=t.model.contactModel.Id);var u=[];e.each(t.model.contactFields,function(e,o){var a={ColumnCaption:o.Caption,ColumnName:e,OldDisplayValue:t.model.cachedContact[e+"Name"]?t.model.cachedContact[e+"Name"]:t.model.cachedContact[e],OldValue:t.model.cachedContact[e],NewDisplayValue:m["R1_"+e+"Name"]?m["R1_"+e+"Name"]:m["R1_"+e],NewValue:m["R1_"+e]};u.push(a)}),m.R1_Changed=r()(u);var p={},h=t.$Lodash.cloneDeep(JSON.parse(t.model.formSetting.lead));t.$Utils.replacePermission(h,p);var g={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestFields:"Id;Code;CreatedByName;ModifiedByName;Version;Code;Store;StoreName;Name;TimeFrame;TimeFrameName;BillCode;OfficialNumber;Author;AuthorName;Source;SourceName;CampaignCode;CampaignCodeName;CustomerCode;DocumentForm;GroupId;FormSetting;Changed;",R1_RequestDataGroup:"DataGroup.lead.9jwnc",R1_RequestTemplate:"xDocument_Document.Insert",R1_CreatedBy:JSON.parse(localStorage.getItem("LoggedOnUser")).UserId,R1_CreatedByName:JSON.parse(localStorage.getItem("LoggedOnUser")).Username,R1_ModifiedBy:JSON.parse(localStorage.getItem("LoggedOnUser")).UserId,R1_ModifiedByName:JSON.parse(localStorage.getItem("LoggedOnUser")).Username,R1_Code:"Lead",R1_GroupId:t.model.posModel.pos.Promulgator,R1_Store:t.model.posModel.pos.Id,R1_StoreName:t.model.posModel.pos.Name,R1_Name:t.model.orderModel.Name,R1_Phone:t.model.orderModel.Phone,R1_TimeFrame:t.model.orderModel.TimeFrame.Id,R1_TimeFrameName:t.model.orderModel.TimeFrame.Name,R1_OfficialNumber:t.model.contactModel.OfficialNumber,R1_Author:t.model.posModel.seller.Id,R1_AuthorName:t.model.posModel.seller.Name,R1_Source:t.model.contactModel.Source.Id,R1_SourceName:t.model.contactModel.Source.Name,R1_CampaignCode:t.model.contactModel.CampaignCode.Id,R1_CampaignCodeName:t.model.contactModel.CampaignCode.Name,R1_Gender:t.model.contactModel.Gender.Id,R1_GenderName:t.model.contactModel.Gender.Name,R1_CustomerCode:t.model.contactModel.CustomerCode,R1_FormSetting:r()(h)},_=[];e.each(t.model.leadFields,function(e,t){var o={ColumnCaption:t.Caption,ColumnName:e,OldDisplayValue:"",OldValue:"",NewDisplayValue:g["R1_"+e+"Name"]?g["R1_"+e+"Name"]:g["R1_"+e],NewValue:g["R1_"+e]};_.push(o)});var C={},R=t.$Lodash.cloneDeep(JSON.parse(t.model.formSetting.order));t.$Utils.replacePermission(R,C),g.R1_Changed=r()(_);var f=[],y={RequestClass:"xBase",RequestAction:"Request",TotalRequests:1,R1_RequestFields:"Id;Code;CreatedByName;Phone;ModifiedByName;Code;Store;StoreName;Name;TimeFrame;TimeFrameName;BillCode;OfficialNumber;Author;AuthorName;Source;SourceName;CampaignCode;CampaignCodeName;CustomerCode;Birthday;MetaDescription;Location;LocationName;TotalComments;TotalDownloads;TotalPages;TotalRatingPoints;TotalRatings;Status;StatusName;MetaDescription;PaymentStatus;PaymentStatusName;Address;Priority;DocumentForm;DocumentField;GroupId;FormSetting;Changed;",R1_RequestDataGroup:"DataGroup.order.9ejnl",R1_RequestTemplate:"xDocument_Document.Update",R1_CreatedBy:JSON.parse(localStorage.getItem("LoggedOnUser")).UserId,R1_CreatedByName:JSON.parse(localStorage.getItem("LoggedOnUser")).Username,R1_ModifiedBy:JSON.parse(localStorage.getItem("LoggedOnUser")).UserId,R1_ModifiedByName:JSON.parse(localStorage.getItem("LoggedOnUser")).Username,R1_Code:"Order",R1_Id:t.model.orderModel.Id,R1_Gender:t.model.contactModel.Gender.Id,R1_GenderName:t.model.contactModel.Gender.Name,R1_GroupId:t.model.posModel.pos.Promulgator,R1_Store:t.model.posModel.pos.Id,R1_StoreName:t.model.posModel.pos.Name,R1_Name:t.model.orderModel.Name,R1_Birthday:t.$Utils.formatDateTime(t.model.contactModel.Birthday),R1_Phone:t.model.orderModel.Phone,R1_TimeFrame:t.model.orderModel.TimeFrame.Id,R1_TimeFrameName:t.model.orderModel.TimeFrame.Name,R1_BillCode:t.model.orderModel.BillCode,R1_OfficialNumber:t.model.contactModel.OfficialNumber,R1_Author:t.model.posModel.seller.Id,R1_AuthorName:t.model.posModel.seller.Name,R1_Source:t.model.contactModel.Source.Id,R1_SourceName:t.model.contactModel.Source.Name,R1_CampaignCode:t.model.contactModel.CampaignCode.Id,R1_CampaignCodeName:t.model.contactModel.CampaignCode.Name,R1_CustomerCode:t.model.contactModel.CustomerCode,R1_Address:t.model.contactModel.Address,R1_Location:t.model.contactModel.Location.Id,R1_LocationName:t.model.contactModel.Location.Name,R1_TotalComments:t.model.paymentModel.gaveMoney,R1_TotalDownloads:parseInt(t.model.paymentModel.cash.replaceAll(".","")),R1_TotalPages:parseInt(t.model.paymentModel.customerCard.replaceAll(".","")),R1_TotalRatingPoints:parseInt(t.model.paymentModel.bankMoney.replaceAll(".","")),R1_TotalRatings:t.model.paymentModel.change,R1_Priority:0,R1_Status:"be311afe-985d-4f79-8e89-c895a4ff0694",R1_StatusName:"Bán",R1_MetaDescription:"39636d3b-705b-4b51-91c9-67afda36c62e",R1_PaymentStatus:"9e4461ea-b25a-46e0-bf5f-db5bfabf2ba4",R1_PaymentStatusName:"Đã thanh toán tại cửa hàng",R1_FormSetting:r()(R)};e.each(t.model.orderFields,function(e,t){var o={ColumnCaption:t.Caption,ColumnName:e,OldDisplayValue:"",OldValue:"",NewDisplayValue:y["R1_"+e+"Name"]?y["R1_"+e+"Name"]:y["R1_"+e],NewValue:y["R1_"+e]};f.push(o)}),y.R1_Changed=r()(f);var N={},b=t.$Lodash.cloneDeep(JSON.parse(t.model.formSetting.orderPart));t.$Utils.replacePermission(b,N);var M={RequestClass:"xBase",RequestAction:"Request",TotalRequests:t.model.cart.length};e.each(t.model.cart,function(o,a){M["R"+(o+1)+"_RequestFields"]="Id;Code;CreatedByName;ModifiedByName;Code;Store;StoreName;Name;Birthday;Phone;TimeFrame;TimeFrameName;BillCode;OfficialNumber;Author;AuthorName;Source;SourceName;CampaignCode;CampaignCodeName;CustomerCode;ProductCode;Parent;OrderId;ProductType;ProductTypeName;ProductPrice;Price;ProductColor;ProductColorName;ProductSize;ProductSizeName;Category;CategoryName;ProductCount;Total;Priority;Status;MetaDescription;DeliveryStatus;DeliveryStatusName;PaymentStatus;PaymentStatusName;ProductUnit;ProductShopCode;Barcode;LocationName;DiscountMoney;DiscountPercent;Address;Banked;;DocumentForm;DocumentField;GroupId;FormSetting;Changed;",M["R"+(o+1)+"_RequestDataGroup"]="DataGroup.orderpart.82fjy",M["R"+(o+1)+"_RequestTemplate"]="xDocument_Document.Update",M["R"+(o+1)+"_CreatedBy"]=JSON.parse(localStorage.getItem("LoggedOnUser")).UserId,M["R"+(o+1)+"_CreatedByName"]=JSON.parse(localStorage.getItem("LoggedOnUser")).Username,M["R"+(o+1)+"_ModifiedBy"]=JSON.parse(localStorage.getItem("LoggedOnUser")).UserId,M["R"+(o+1)+"_ModifiedByName"]=JSON.parse(localStorage.getItem("LoggedOnUser")).Username,M["R"+(o+1)+"_Code"]="OrderPart",M["R"+(o+1)+"_Id"]=a.OrderPartId,M["R"+(o+1)+"_GroupId"]=t.model.posModel.pos.Promulgator,M["R"+(o+1)+"_Store"]=t.model.posModel.pos.Id,M["R"+(o+1)+"_StoreName"]=t.model.posModel.pos.Name,M["R"+(o+1)+"_Name"]=t.model.orderModel.Name,M["R"+(o+1)+"_Birthday"]=t.$Utils.formatDateTime(t.model.contactModel.Birthday),M["R"+(o+1)+"_Phone"]=t.model.orderModel.Phone,M["R"+(o+1)+"_TimeFrame"]=t.model.orderModel.TimeFrame.Id,M["R"+(o+1)+"_TimeFrameName"]=t.model.orderModel.TimeFrame.Name,M["R"+(o+1)+"_BillCode"]=t.model.orderModel.BillCode,M["R"+(o+1)+"_OfficialNumber"]=t.model.contactModel.OfficialNumber,M["R"+(o+1)+"_Author"]=t.model.posModel.seller.Id,M["R"+(o+1)+"_AuthorName"]=t.model.posModel.seller.Name,M["R"+(o+1)+"_Source"]=t.model.contactModel.Source.Id,M["R"+(o+1)+"_SourceName"]=t.model.contactModel.Source.Name,M["R"+(o+1)+"_CampaignCode"]=t.model.contactModel.CampaignCode.Id,M["R"+(o+1)+"_CampaignCodeName"]=t.model.contactModel.CampaignCode.Name,M["R"+(o+1)+"_CustomerCode"]=t.model.contactModel.CustomerCode,M["R"+(o+1)+"_FormSetting"]=r()(b),M["R"+(o+1)+"_ProductCode"]=a.ProductCode,M["R"+(o+1)+"_ProductType"]=a.Categories,M["R"+(o+1)+"_ProductTypeName"]=a.CategoriesName,M["R"+(o+1)+"_ProductPrice"]=a.TotalPages,M["R"+(o+1)+"_Price"]=t.model.paymentModel.sum_of_payment,M["R"+(o+1)+"_ProductColor"]=a.ProductColor,M["R"+(o+1)+"_ProductColorName"]=a.ProductColorName,M["R"+(o+1)+"_ProductSize"]=a.Size,M["R"+(o+1)+"_ProductSizeName"]=a.SizeName,M["R"+(o+1)+"_Category"]=t.model.orderModel.Warehouse.Id,M["R"+(o+1)+"_CategoryName"]=t.model.orderModel.Warehouse.Name,M["R"+(o+1)+"_LocationName"]=t.model.contactModel.Location.Name,M["R"+(o+1)+"_Address"]=t.model.contactModel.Address,M["R"+(o+1)+"_DiscountMoney"]=a.DiscountMoney,M["R"+(o+1)+"_DiscountPercent"]=a.DiscountPercent,M["R"+(o+1)+"_Gender"]=t.model.contactModel.Gender.Id,M["R"+(o+1)+"_GenderName"]=t.model.contactModel.Gender.Name,M["R"+(o+1)+"_ProductCount"]=a.Quantity,M["R"+(o+1)+"_Banked"]=a.Quantity,M["R"+(o+1)+"_Total"]=(parseInt(a.TotalPages)-(isNaN(parseInt(a.DiscountMoney))?0:parseInt(a.DiscountMoney))-(isNaN(parseInt(a.DiscountPercent))?0:parseInt(a.DiscountPercent)/100*parseInt(a.TotalPages)))*parseInt(a.Quantity),M["R"+(o+1)+"_Priority"]=0,M["R"+(o+1)+"_Status"]="be311afe-985d-4f79-8e89-c895a4ff0694",M["R"+(o+1)+"_MetaDescription"]="39636d3b-705b-4b51-91c9-67afda36c62e",M["R"+(o+1)+"_DeliveryStatus"]="93bfb67d-e659-48a5-9236-f727312cd2e2",M["R"+(o+1)+"_DeliveryStatusName"]="Khách đã nhận",M["R"+(o+1)+"_PaymentStatus"]="9e4461ea-b25a-46e0-bf5f-db5bfabf2ba4",M["R"+(o+1)+"_PaymentStatusName"]="Đã thanh toán tại cửa hàng",M["R"+(o+1)+"_ProductUnit"]=a.SourceUrl,M["R"+(o+1)+"_ProductShopCode"]=a.MetaDescriptionName,M["R"+(o+1)+"_Barcode"]=a.MetaKeywords;var l=[];e.each(t.orderPartFields,function(e,t){var a={ColumnCaption:t.Caption,ColumnName:o,OldDisplayValue:"",OldValue:"",NewDisplayValue:M["R"+(o+1)+"_"+e+"Name"]?M["R"+(o+1)+"_"+e+"Name"]:M["R"+(o+1)+"_"+e],NewValue:M["R"+(o+1)+"_"+e]};l.push(a)}),M["R"+(o+1)+"_Changed"]=r()(l)}),t.$Utils.post(m).then(function(e){e.success&&(g.R1_DocumentForm=e.R1.Data,y.R1_DocumentForm=e.R1.Data,t.$Utils.post(g).then(function(o){if(o.success){y.R1_DocumentField=o.R1.Data;for(var a=1;a<=M.TotalRequests;a++)M["R"+a+"_DocumentForm"]=e.R1.Data,M["R"+a+"_DocumentField"]=o.R1.Data;t.$Utils.post(M).then(function(e){}),t.$Utils.postCheckResult(y).then(function(e){e.success&&(t.model.orderModel.MetaDescription=y.R1_MetaDescription,t.model.disabled=!0,t.$setItemLocalStorage("BILL"+t.item.name,r()(t.model)),t.$message.success("Đơn hàng đã lưu"))})}}))})}})})})})})},getValueFromVariable:function(t,o){var a="";if(t&&t.constructor==String){var l=t.split("."),r=o;e.each(l,function(e,t){if(void 0==r)return a="",!1;r=r[t],a=r})}return a},print:function(){var t=this,o=this,a=this.$Lodash.cloneDeep(this.$singleRequest);a.TotalRequests=1,a.R1_RequestTemplate="SettingNew.SearchSetting",a.R1_Code="xSetting.Project.Parameter.CRM2.Order.OrderTemplatePrint",this.$Utils.post(a).then(function(a){var a=t.$Utils.getDataWithRoot(a.R1,"Data.DynamicDS.Setting")[0],l=o.$Utils.decodeHtmlEntities(a.Description),r=JSON.parse(a.Value);try{r.loops&&e.each(r.loops,function(a,r){var n="",d=l+"";d=d.split("<"+a+">"),n=d[1].split("</"+a+">")[0];var s="";e.each(o.model.cart,function(a,l){var r=n+"";e.each(t.model.fieldMappingPrinter,function(e,t){t.indexOf(".loopVal")>0&&(r=r.replaceAll("{{"+e+"}}",(o.getValueFromVariable((t+"").replaceAll(".loopVal",""),l)+"").replaceAll(".00","")))}),s+=r}),l=l.replaceAll(n,s)}),e.each(o.model.fieldMappingPrinter,function(e,t){l=l.replaceAll("{{"+e+"}}",o.getValueFromVariable(t,o)+"")}),e.each(r.allVariables,function(e,t){l.indexOf("{{"+t+"}}")>-1&&(l=l.replaceAll("{{"+t+"}}",""))}),l=l.replaceAll("undefined","");var n=window.open("","PRINT",r.paper);n.document.write(l),setTimeout(function(){n.document.close(),n.focus(),n.print(),n.close()},250)}catch(e){console.log(e)}})},changeCampaign:function(t){var o=this;e.each(this.model.params.campaignCodes,function(e,a){if(t==a.Id)return o.model.contactModel.CampaignCode=a,!1})}},created:function(){var e=this;this.loadResources(),this.getFormSetting("contact","Form.contact.0094e"),this.getFormSetting("order","Form.order.0f1d6"),this.getFormSetting("orderPart","Form.hoa-don.0fbh5"),this.getFormSetting("lead","Form.lead.0d8cb"),this.getFormSetting("warehouse","Form.chinh-sua-du-lieu-ton-kho.0c240"),this.onCustomerCashChange(),this.calculateOrderCash(this.model.cart),this.$hub.$on("closeTab",function(t){t===e.item.name&&(""!=e.model.orderModel.MetaDescription||""==e.model.orderModel.Id?e.$hub.$emit("deleteOrder",{list:void 0,targetName:t}):e.$hub.$emit("deleteOrder",{list:e.model.cart,targetName:t,formSetting:e.model.formSetting.warehouse,orderId:e.model.orderModel.Id}),delete localStorage["BILL"+e.item.name])})},watch:{"model.orderModel.Warehouse":function(t){var o=this;e.each(this.model.params.poses,function(e,a){if(a.Category.indexOf(t.Id)>-1)return o.model.posModel.pos=a,!1})},"model.productEditing.DiscountMoney":function(){this.computeTotalMoney()},"model.productEditing.DiscountPercent":function(){this.computeTotalMoney()},"model.paymentModel.cash":function(e){this.model.paymentModel.cash=this.format_currency(e),this.model.paymentModel.gaveMoney=parseInt(this.model.paymentModel.cash.replaceAll(".",""))+parseInt(this.model.paymentModel.customerCard.replaceAll(".",""))+parseInt(this.model.paymentModel.bankMoney.replaceAll(".","")),this.onCustomerCashChange()},"model.paymentModel.customerCard":function(e){this.model.paymentModel.customerCard=this.format_currency(e),this.model.paymentModel.gaveMoney=parseInt(this.model.paymentModel.cash.replaceAll(".",""))+parseInt(this.model.paymentModel.customerCard.replaceAll(".",""))+parseInt(this.model.paymentModel.bankMoney.replaceAll(".","")),this.onCustomerCashChange()},"model.paymentModel.bankMoney":function(e){this.model.paymentModel.bankMoney=this.format_currency(e),this.model.paymentModel.gaveMoney=parseInt(this.model.paymentModel.cash.replaceAll(".",""))+parseInt(this.model.paymentModel.customerCard.replaceAll(".",""))+parseInt(this.model.paymentModel.bankMoney.replaceAll(".","")),this.onCustomerCashChange()},"model.cart":{handler:function(e){this.calculateOrderCash(e)},deep:!0}},destroyed:function(){}}}).call(t,o(2),o(989)(e))},1245:function(e,t,o){"use strict";var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"Store__ROOT"},[o("div",{staticClass:"col-lg-8"},[o("div",{staticClass:"step__wrapper"},[o("el-card",{attrs:{label:"Giỏ hàng"}},[o("div",{staticClass:"Cart__ROOT"},[o("div",{staticClass:"cart__header"},[o("div",{staticClass:"col-lg-6 pd0"},[o("strong",[e._v("Giỏ hàng")])]),e._v(" "),o("div",{staticClass:"col-lg-6 pd0"},[o("div",{staticClass:"row"},[o("div",{staticClass:"col-lg-5"},[o("el-select",{attrs:{disabled:e.model.disabled,"value-key":"Id",placeholder:"Chọn kho hàng (bắt buộc)",filterable:""},model:{value:e.model.orderModel.Warehouse,callback:function(t){e.$set(e.model.orderModel,"Warehouse",t)},expression:"model.orderModel.Warehouse"}},e._l(e.model.params.warehouses,function(e){return o("el-option",{key:e.Id,attrs:{label:e.Name,value:e}})}))],1),e._v(" "),o("div",{staticClass:"col-lg-7"},[o("el-input",{attrs:{disabled:e.model.disabled,placeholder:"Nhập Barcode và Enter","suffix-icon":"el-icon-search"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.handleBarcodeSearchConfirm(t)}},model:{value:e.model.barcode_search_keyword,callback:function(t){e.$set(e.model,"barcode_search_keyword",t)},expression:"model.barcode_search_keyword"}})],1)])]),e._v(" "),o("div",{staticClass:"clearfix"})]),e._v(" "),o("div",{staticClass:"cart__content"},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:e.model.cart,"empty-text":"Không có dữ liệu",border:""}},[o("el-table-column",{attrs:{type:"index",width:"40",align:"center","header-align":"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"MetaKeywords",width:"75",label:"Barcode"}}),e._v(" "),o("el-table-column",{attrs:{prop:"ProductCode",width:"200",label:"Mã sản phẩm"}}),e._v(" "),o("el-table-column",{attrs:{prop:"TotalPages",label:"Đơn giá"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",{staticClass:"ovf-elipsis"},[e._v("\n                      "+e._s(e.format_currency(parseInt(t.row.TotalPages))+" đ")+"\n                    ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"Số lượng",prop:"Quantity"}}),e._v(" "),o("el-table-column",{attrs:{label:"Chiết khấu tiền"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",{staticClass:"ovf-elipsis"},[e._v("\n                      "+e._s(e.format_currency(t.row.DiscountMoney)+" đ")+"\n                    ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"Chiết khấu %"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",{staticClass:"ovf-elipsis"},[e._v("\n                      "+e._s(t.row.DiscountPercent?t.row.DiscountPercent+" %":"0%")+"\n                    ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"Total",label:"Thành tiền"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",{staticClass:"ovf-elipsis"},[o("a",{attrs:{hidden:""}},[e._v(e._s(t.row.Total=(parseInt(t.row.TotalPages)-(isNaN(parseInt(t.row.DiscountMoney))?0:parseInt(t.row.DiscountMoney))-(isNaN(parseInt(t.row.DiscountPercent))?0:parseInt(t.row.DiscountPercent)/100*parseInt(t.row.TotalPages)))*parseInt(t.row.Quantity)))]),e._v("\n                      "+e._s(e.format_currency(t.row.Total)+" đ")+"\n                      ")])]}}])}),e._v(" "),e.model.disabled?e._e():o("el-table-column",{attrs:{label:"Hành động",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{on:{click:function(o){e.handleEditProduct(t.row.Id)}}},[o("i",{staticClass:"fa fa-pencil"})]),e._v(" "),o("el-button",{staticStyle:{margin:"3px 0"},attrs:{type:"danger"},on:{click:function(o){e.handleDeleteProduct(t.row.Id,t.row)}}},[o("i",{staticClass:"fa fa-trash"})])]}}])})],1)],1),e._v(" "),o("div",{staticClass:"modal__wrapper"},[o("el-dialog",{attrs:{title:"Chỉnh sửa thông tin sản phẩm",visible:e.model.showEditProductModal,"before-close":e.handleCloseEditProductModal},on:{"update:visible":function(t){e.$set(e.model,"showEditProductModal",t)}}},[o("el-form",{ref:"productEditing",attrs:{disabled:e.model.disabled,model:e.model.productEditing,"label-width":"150px","label-position":e.$isMobileDevice?"top":"right"}},[o("el-form-item",{attrs:{label:"Barcode"}},[o("el-input",{attrs:{disabled:""},model:{value:e.model.productEditing.TotalPages,callback:function(t){e.$set(e.model.productEditing,"TotalPages",t)},expression:"model.productEditing.TotalPages"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Mã hàng"}},[o("el-input",{attrs:{disabled:""},model:{value:e.model.productEditing.ProductCode,callback:function(t){e.$set(e.model.productEditing,"ProductCode",t)},expression:"model.productEditing.ProductCode"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Size"}},[o("el-input",{attrs:{disabled:""},model:{value:e.model.productEditing.SizeName,callback:function(t){e.$set(e.model.productEditing,"SizeName",t)},expression:"model.productEditing.SizeName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Màu sắc"}},[o("el-input",{attrs:{disabled:""},model:{value:e.model.productEditing.ProductColorName,callback:function(t){e.$set(e.model.productEditing,"ProductColorName",t)},expression:"model.productEditing.ProductColorName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Kho"}},[o("el-input",{attrs:{disabled:""},model:{value:e.model.productEditing.CategoryName,callback:function(t){e.$set(e.model.productEditing,"CategoryName",t)},expression:"model.productEditing.CategoryName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Số lượng"}},[o("el-input",{attrs:{disabled:""},model:{value:e.model.productEditing.Quantity,callback:function(t){e.$set(e.model.productEditing,"Quantity",t)},expression:"model.productEditing.Quantity"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Đơn giá"}},[o("el-input",{attrs:{disabled:""},model:{value:e.model.productEditing.TotalPages,callback:function(t){e.$set(e.model.productEditing,"TotalPages",t)},expression:"model.productEditing.TotalPages"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Chiết khấu (bằng hình thức số tiền)"}},[o("el-input",{model:{value:e.model.productEditing.DiscountMoney,callback:function(t){e.$set(e.model.productEditing,"DiscountMoney",t)},expression:"model.productEditing.DiscountMoney"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Chiết khấu (bằng hình thức %)"}},[o("el-input",{model:{value:e.model.productEditing.DiscountPercent,callback:function(t){e.$set(e.model.productEditing,"DiscountPercent",t)},expression:"model.productEditing.DiscountPercent"}})],1),e._v(" "),o("el-form-item",[o("div",{staticClass:"group-button tac"},[o("el-button",{attrs:{type:"primary"},on:{click:e.handleUpdateProduct}},[e._v("\n                        Cập nhật\n                      ")]),e._v(" "),o("el-button",{on:{click:e.handleCloseEditProductModal}},[e._v("Hủy")])],1)])],1)],1)],1)])])],1),e._v(" "),o("div",{staticClass:"step-content__wrapper",staticStyle:{"padding-top":"20px"}})]),e._v(" "),o("div",{staticClass:"col-lg-4 pd0"},[o("el-card",[o("el-tabs",[o("el-tab-pane",{attrs:{label:"Đơn hàng"}},[o("div",{attrs:{label:"Đơn hàng"}},[o("div",{staticClass:"Order__ROOT"},[o("div",{staticClass:"contact__header"},[o("div",{staticClass:"col-lg-12 pd0"},[o("el-autocomplete",{staticStyle:{width:"100%"},attrs:{disabled:e.model.disabled,"auto-complete":"on","fetch-suggestions":e.querySearch,placeholder:"Tìm khách hàng","suffix-icon":"el-icon-search"},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function(t){return[""!==t.item.Name?o("span",[o("b",[e._v("Tên:")]),e._v(" "+e._s(t.item.Name))]):e._e(),e._v(" "),t.item.IdentityCode&&""!==t.item.IdentityCode?o("span",[e._v("-  "),o("b",[e._v("Mã khách:")]),e._v(" "+e._s(t.item.IdentityCode))]):e._e(),e._v(" "),t.item.Phone&&""!==t.item.Phone?o("span",[e._v("-  "),o("b",[e._v("SĐT:")]),e._v(" "+e._s(t.item.Phone))]):e._e()]}}]),model:{value:e.model.contact_search_keyword,callback:function(t){e.$set(e.model,"contact_search_keyword",t)},expression:"model.contact_search_keyword"}})],1),e._v(" "),o("div",{staticClass:"clearfix"})]),e._v(" "),o("div",{staticClass:"contact__content",staticStyle:{padding:"10px"}},[o("el-form",{ref:"orderForm",attrs:{disabled:e.model.disabled,"label-position":"left","label-width":"100px",model:e.model.orderModel,inline:!1,rules:e.model.orderRules}},[o("el-form-item",{attrs:{label:"Tên KH",prop:"Name"}},[o("el-input",{attrs:{placeholder:"Nguyễn Văn A"},model:{value:e.model.orderModel.Name,callback:function(t){e.$set(e.model.orderModel,"Name",t)},expression:"model.orderModel.Name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Điện thoại",prop:"Phone"}},[o("el-input",{attrs:{type:"number",placeholder:"01234567890"},model:{value:e.model.orderModel.Phone,callback:function(t){e.$set(e.model.orderModel,"Phone",t)},expression:"model.orderModel.Phone"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Mã hóa đơn",prop:"BillCode"}},[o("el-input",{attrs:{placeholder:"Mã hóa đơn"},model:{value:e.model.orderModel.BillCode,callback:function(t){e.$set(e.model.orderModel,"BillCode",t)},expression:"model.orderModel.BillCode"}})],1)],1)],1)])])]),e._v(" "),o("el-tab-pane",{attrs:{label:"Thông tin"}},[o("div",{attrs:{label:"Khách hàng"}},[o("div",{staticClass:"Contact__ROOT"},[o("div",{staticClass:"contact__content",staticStyle:{padding:"10px"}},[o("el-form",{ref:"contactForm",attrs:{disabled:e.model.disabled,"label-position":"left","label-width":"100px",model:e.model.contactModel,inline:!1,rules:e.model.contactRules}},[o("el-form-item",{attrs:{label:"Mã KH",prop:"CustomerCode"}},[o("el-input",{attrs:{placeholder:"MA.0001"},model:{value:e.model.contactModel.CustomerCode,callback:function(t){e.$set(e.model.contactModel,"CustomerCode",t)},expression:"model.contactModel.CustomerCode"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Mã liên hệ",prop:"OfficialNumber"}},[o("el-input",{attrs:{placeholder:"Mã liên hệ"},model:{value:e.model.contactModel.OfficialNumber,callback:function(t){e.$set(e.model.contactModel,"OfficialNumber",t)},expression:"model.contactModel.OfficialNumber"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Chiến dịch",prop:"CampaignCode"}},[o("el-select",{attrs:{filterable:""},on:{change:e.changeCampaign},model:{value:e.model.campaignId,callback:function(t){e.$set(e.model,"campaignId",t)},expression:"model.campaignId"}},e._l(e.model.params.campaignCodes,function(e){return o("el-option",{key:e.Id,attrs:{label:e.Name,value:e.Id}})}))],1),e._v(" "),o("el-form-item",{attrs:{label:"Giới tính",prop:"Gender"}},[o("el-select",{attrs:{"value-key":"Id"},model:{value:e.model.contactModel.Gender,callback:function(t){e.$set(e.model.contactModel,"Gender",t)},expression:"model.contactModel.Gender"}},e._l(e.model.params.genders,function(e){return o("el-option",{key:e.Id,attrs:{label:e.Name,value:e}})}))],1),e._v(" "),o("el-form-item",{attrs:{label:"Nguồn KH",prop:"Source"}},[o("el-select",{attrs:{"value-key":"Id",filterable:"",clearable:""},model:{value:e.model.contactModel.Source,callback:function(t){e.$set(e.model.contactModel,"Source",t)},expression:"model.contactModel.Source"}},e._l(e.model.params.sources,function(e){return o("el-option",{key:e.Id,attrs:{label:e.Name,value:e}})}))],1),e._v(" "),o("el-form-item",{attrs:{label:"Ngày sinh",prop:"Birthday"}},[o("el-date-picker",{attrs:{type:"date",format:"dd/MM/yyyy",placeholder:"01/01/1990"},model:{value:e.model.contactModel.Birthday,callback:function(t){e.$set(e.model.contactModel,"Birthday",t)},expression:"model.contactModel.Birthday"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"Tỉnh thành",prop:"Location"}},[o("el-select",{attrs:{"value-key":"Id",placeholder:"Hà Nội",filterable:"",clearable:""},model:{value:e.model.contactModel.Location,callback:function(t){e.$set(e.model.contactModel,"Location",t)},expression:"model.contactModel.Location"}},e._l(e.model.params.provinces,function(e){return o("el-option",{key:e.Id,attrs:{label:e.Name,value:e}})}))],1),e._v(" "),o("el-form-item",{attrs:{label:"Địa chỉ",prop:"Address"}},[o("el-input",{attrs:{type:"textarea",rows:3},model:{value:e.model.contactModel.Address,callback:function(t){e.$set(e.model.contactModel,"Address",t)},expression:"model.contactModel.Address"}})],1)],1)],1)])]),e._v(" "),o("div",{staticClass:"pos-info__wrapper"},[o("div",{staticClass:"block__label"},[e._v("\n                Thông tin cửa hàng\n              ")]),e._v(" "),o("div",{staticClass:"block__wrapper"},[o("el-form",{ref:"posForm",attrs:{disabled:e.model.disabled,"label-position":"left","label-width":"110px",rules:e.model.posRules,model:e.model.posModel}},[o("el-form-item",{attrs:{label:"Cửa hàng",prop:"pos"}},[o("el-select",{attrs:{placeholder:"Chọn cửa hàng","value-key":"Id",filterable:""},model:{value:e.model.posModel.pos,callback:function(t){e.$set(e.model.posModel,"pos",t)},expression:"model.posModel.pos"}},e._l(e.model.params.poses,function(e){return o("el-option",{key:e.Id,attrs:{label:e.Name,value:e}})}))],1),e._v(" "),o("el-form-item",{attrs:{label:"NV Bán hàng",prop:"seller"}},[o("el-select",{attrs:{placeholder:"Chọn NV bán hàng","value-key":"Id",filterable:""},model:{value:e.model.posModel.seller,callback:function(t){e.$set(e.model.posModel,"seller",t)},expression:"model.posModel.seller"}},e._l(e.model.params.users,function(e){return o("el-option",{key:e.Id,attrs:{label:e.Name,value:e}})}))],1)],1)],1)])])],1),e._v(" "),o("div",{staticClass:"payment__wrapper"},[o("div",{staticClass:"block__label"},[e._v("\n          Thông tin thanh toán\n        ")]),e._v(" "),o("div",{staticClass:"block__wrapper"},[o("el-form",{ref:"paymentForm",attrs:{disabled:e.model.disabled,"label-position":"left","label-width":"120px",rules:e.model.paymentRules,model:e.model.paymentModel}},[o("el-form-item",[[o("span",{attrs:{slot:"label"},slot:"label"},[o("b",[e._v("Tổng:")])]),e._v(" "),o("h2",[o("strong",[e._v("\n                    "+e._s(e.format_currency(e.model.paymentModel.sum_of_payment))+" đ\n                  ")])])]],2),e._v(" "),o("el-form-item",[[o("span",{attrs:{slot:"label"},slot:"label"},[o("b",[e._v("Tiền khách trả:")])]),e._v(" "),o("span",[e._v(" "+e._s(e.format_currency(e.model.paymentModel.gaveMoney))+" đ")])]],2),e._v(" "),o("el-form-item",[[o("span",{attrs:{slot:"label"},slot:"label"},[e._v("      Tiền mặt:")]),e._v(" "),o("el-input",{attrs:{placeholder:"1000000"},model:{value:e.model.paymentModel.cash,callback:function(t){e.$set(e.model.paymentModel,"cash",t)},expression:"model.paymentModel.cash"}})]],2),e._v(" "),o("el-form-item",[[o("span",{attrs:{slot:"label"},slot:"label"},[e._v("      Hội viên:")]),e._v(" "),o("el-input",{attrs:{placeholder:"1000000"},model:{value:e.model.paymentModel.customerCard,callback:function(t){e.$set(e.model.paymentModel,"customerCard",t)},expression:"model.paymentModel.customerCard"}})]],2),e._v(" "),o("el-form-item",[[o("span",{attrs:{slot:"label"},slot:"label"},[e._v("      Quẹt thẻ:")]),e._v(" "),o("el-input",{attrs:{placeholder:"1000000"},model:{value:e.model.paymentModel.bankMoney,callback:function(t){e.$set(e.model.paymentModel,"bankMoney",t)},expression:"model.paymentModel.bankMoney"}})]],2),e._v(" "),o("el-form-item",{attrs:{prop:"change"}},[[o("span",{attrs:{slot:"label"},slot:"label"},[o("b",[e._v("Tiền trả lại:")])]),e._v(" "),o("span",[e._v(e._s(e.model.paymentModel.change)+" đ")])]],2),e._v(" "),o("el-form-item",{attrs:{label:"","label-width":"0px"}},[o("br"),e._v(" "),""==e.model.orderModel.MetaDescription?o("el-button",{staticClass:"btn btn-block ",attrs:{type:"danger"},on:{click:e.save}},[e._v("Thanh toán")]):e._e(),e._v(" "),""!=e.model.orderModel.MetaDescription?o("el-button",{staticClass:"btn btn-block fa fa-print",attrs:{type:"info"},on:{click:e.print}},[e._v("In")]):e._e()],1)],1)],1)])],1)],1),e._v(" "),o("div",{staticClass:"clearfix"})])},l=[],r={render:a,staticRenderFns:l};t.a=r},1246:function(e,t,o){"use strict";var a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-tabs",{attrs:{type:"border-card",editable:""},on:{edit:e.handleTabsEdit},model:{value:e.model.editableTabsValue,callback:function(t){e.$set(e.model,"editableTabsValue",t)},expression:"model.editableTabsValue"}},e._l(e.model.editableTabs,function(e,t){return o("el-tab-pane",{key:e.name,attrs:{label:e.title,name:e.name}},[o("POS",{attrs:{item:e}})],1)}))},l=[],r={render:a,staticRenderFns:l};t.a=r},970:function(e,t,o){"use strict";function a(e){o(1238)}Object.defineProperty(t,"__esModule",{value:!0});var l=o(1240),r=o(1246),n=o(0),d=a,s=n(l.a,r.a,!1,d,"data-v-ef989de2",null);t.default=s.exports},989:function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}}});
//# sourceMappingURL=13.528967bae011aef9fb95.js.map